<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.13"/>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-scrollTo/2.1.2/jquery.scrollTo.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-powertip/1.2.0/jquery.powertip.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.smartmenus/1.0.1/jquery.smartmenus.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.smartmenus/1.0.1/addons/keyboard/jquery.smartmenus.keyboard.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.smartmenus/1.0.1/addons/bootstrap/jquery.smartmenus.bootstrap.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
        <title>MoMEMta: modules/BlockC.cc Source File</title>
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
        <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/solarized-light.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery.smartmenus/1.0.1/addons/bootstrap/jquery.smartmenus.bootstrap.min.css">
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-navbar" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                  </button>
                    <a class="navbar-brand">MoMEMta </a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel panel-default" style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_e05d7e2b1ecd646af5bb94391405f3b5.html">modules</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">BlockC.cc</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *  MoMEMta: a modular implementation of the Matrix Element Method</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *  Copyright (C) 2017  Universite catholique de Louvain (UCL), Belgium</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *  This program is free software: you can redistribute it and/or modify</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *  it under the terms of the GNU General Public License as published by</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *  the Free Software Foundation, either version 3 of the License, or</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *  (at your option) any later version.</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *  This program is distributed in the hope that it will be useful,</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *  GNU General Public License for more details.</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> *  You should have received a copy of the GNU General Public License</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *  along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="Math_8h.html">momemta/Math.h</a>&gt;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;momemta/Module.h&gt;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;momemta/ParameterSet.h&gt;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;momemta/Solution.h&gt;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;momemta/Types.h&gt;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="classBlockC.html">   81</a></span>&#160;<span class="keyword">class </span><a class="code" href="classBlockC.html">BlockC</a> : <span class="keyword">public</span> <a class="code" href="classModule.html">Module</a> {</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <a class="code" href="classBlockC.html">BlockC</a>(PoolPtr pool, <span class="keyword">const</span> <a class="code" href="classParameterSet.html">ParameterSet</a>&amp; parameters) : <a class="code" href="classModule.html#a17cb586f94658e2048759c4cbdb7968d">Module</a>(pool, parameters.getModuleName()) {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        sqrt_s = parameters.globalParameters().get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;energy&quot;</span>);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        pT_is_met = parameters.get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;pT_is_met&quot;</span>, <span class="keyword">false</span>);</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        s12 = get&lt;double&gt;(parameters.get&lt;<a class="code" href="structInputTag.html">InputTag</a>&gt;(<span class="stringliteral">&quot;s12&quot;</span>));</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        s123 = get&lt;double&gt;(parameters.get&lt;<a class="code" href="structInputTag.html">InputTag</a>&gt;(<span class="stringliteral">&quot;s123&quot;</span>));</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        m1 = parameters.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;m1&quot;</span>, 0.);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        p2 = get&lt;LorentzVector&gt;(parameters.get&lt;<a class="code" href="structInputTag.html">InputTag</a>&gt;(<span class="stringliteral">&quot;p2&quot;</span>));</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        p3 = get&lt;LorentzVector&gt;(parameters.get&lt;<a class="code" href="structInputTag.html">InputTag</a>&gt;(<span class="stringliteral">&quot;p3&quot;</span>));</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordflow">if</span> (parameters.exists(<span class="stringliteral">&quot;branches&quot;</span>)) {</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            <span class="keyword">auto</span> branches_tags = parameters.get&lt;std::vector&lt;InputTag&gt;&gt;(<span class="stringliteral">&quot;branches&quot;</span>);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; t : branches_tags)</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                m_branches.push_back(get&lt;LorentzVector&gt;(t));</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        }</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <span class="comment">// If the met input is specified, get it, otherwise retrieve default</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="comment">// one (&quot;met::p4&quot;)</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <a class="code" href="structInputTag.html">InputTag</a> met_tag;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="keywordflow">if</span> (parameters.exists(<span class="stringliteral">&quot;met&quot;</span>)) {</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            met_tag = parameters.get&lt;<a class="code" href="structInputTag.html">InputTag</a>&gt;(<span class="stringliteral">&quot;met&quot;</span>);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            met_tag = <a class="code" href="structInputTag.html">InputTag</a>({<span class="stringliteral">&quot;met&quot;</span>, <span class="stringliteral">&quot;p4&quot;</span>});</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        }</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        m_met = get&lt;LorentzVector&gt;(met_tag);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    };</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="classBlockC.html#ac8275429daf5ec0611efd90474c20f16">  112</a></span>&#160;    <span class="keyword">virtual</span> Status <a class="code" href="classBlockC.html#ac8275429daf5ec0611efd90474c20f16">work</a>()<span class="keyword"> override </span>{</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        solutions-&gt;clear();</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        </div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> p2Sq = p2-&gt;M2();</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="comment">// Don&#39;t spend time on unphysical corner of the phase-space</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keywordflow">if</span> (*s12 &gt;= *s123 || *s123 &gt;= <a class="code" href="Math_8h.html#ac3644f84794a8bfdacf39c4b2c2495fc">SQ</a>(sqrt_s) || *s12 &lt;= p2Sq + <a class="code" href="Math_8h.html#ac3644f84794a8bfdacf39c4b2c2495fc">SQ</a>(m1))</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            <span class="keywordflow">return</span> Status::NEXT;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="comment">// pT will be used to fix the transverse momentum of the reconstructed neutrinos</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <span class="comment">// We can either enforce momentum conservation by disregarding the MET, ie:</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="comment">//  pT = sum of all the visible particles,</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <span class="comment">// Or we can fix it using the MET given as input:</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <span class="comment">//  pT = -MET</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="comment">// In the latter case, it is the user&#39;s job to ensure momentum conservation at</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="comment">// the matrix element level (by using the Boost module, for instance).</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        LorentzVector pT;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordflow">if</span> (pT_is_met) {</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            pT = -*m_met;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            pT = *p2;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; m_branches.size(); i++) {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                pT += *m_branches[i];</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            }</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        }</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="comment">// p1x = alpha1 E1 + beta1 ALPHA + gamma1</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="comment">// p1y = ...(2)</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="comment">// p1z = ...(3)</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="comment">// E3  = ...(4)</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> cosphi3 = std::cos(p3-&gt;Phi());</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> sinphi3 = std::sin(p3-&gt;Phi());</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> costhe3 = std::cos(p3-&gt;Theta());</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> sinthe3 = std::sin(p3-&gt;Theta());</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> E2 = p2-&gt;E();</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> p2x = p2-&gt;Px();</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> p2y = p2-&gt;Py();</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> p2z = p2-&gt;Pz();</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> pTx = pT.Px();</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> pTy = pT.Py();</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="comment">// Term appears regularly, compute once.</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> X = p2x * sinthe3 * cosphi3 + p2y * sinthe3 * sinphi3 + p2z * costhe3;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="comment">// Denominator that appears in several of the follwing eq.</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="comment">// No need to compute it multiple times</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> denom = 2. * (E2 - X);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> beta1 = (cosphi3 * sinthe3) / denom;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> gamma1 =</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                -(2 * E2 * pTx - 2 * X * pTx - *s12 * cosphi3 * sinthe3 + *s123 * cosphi3 * sinthe3) / denom;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> beta2 = (sinthe3 * sinphi3) / denom;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> gamma2 =</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                -(2 * E2 * pTy - 2 * X * pTy - *s12 * sinthe3 * sinphi3 + *s123 * sinthe3 * sinphi3) / denom;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> alpha3 = E2 / p2z;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> beta3 = (p2x * cosphi3 * sinthe3 + p2y * sinthe3 * sinphi3) / (-p2z * denom);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> gamma3 = 0.5 *</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                              (-*s12 + <a class="code" href="Math_8h.html#ac3644f84794a8bfdacf39c4b2c2495fc">SQ</a>(m1) + p2Sq + 2 * p2x * (pTx + sinthe3 * cosphi3 * (*s123 - *s12) / denom) +</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                               2 * p2y * (pTy + sinthe3 * sinphi3 * (*s123 - *s12) / denom)) /</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                              p2z;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> beta4 = -1. / denom;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> gamma4 = (*s123 - *s12) / denom;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="comment">// a11 E1^2 + a22 ALPHA^2 + a12 E1*ALPHA + a10 E1 + a01 ALPHA + a00 = 0</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="comment">// id. with bij</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> a11 = <a class="code" href="Math_8h.html#ac3644f84794a8bfdacf39c4b2c2495fc">SQ</a>(alpha3) - 1;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> a22 = <a class="code" href="Math_8h.html#ac3644f84794a8bfdacf39c4b2c2495fc">SQ</a>(beta1) + <a class="code" href="Math_8h.html#ac3644f84794a8bfdacf39c4b2c2495fc">SQ</a>(beta2) + <a class="code" href="Math_8h.html#ac3644f84794a8bfdacf39c4b2c2495fc">SQ</a>(beta3);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> a12 = 2. * (alpha3 * beta3);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> a10 = 2. * (alpha3 * gamma3);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> a01 = 2. * (beta1 * gamma1 + beta2 * gamma2 + beta3 * gamma3);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> a00 = <a class="code" href="Math_8h.html#ac3644f84794a8bfdacf39c4b2c2495fc">SQ</a>(gamma1) + <a class="code" href="Math_8h.html#ac3644f84794a8bfdacf39c4b2c2495fc">SQ</a>(gamma2) + <a class="code" href="Math_8h.html#ac3644f84794a8bfdacf39c4b2c2495fc">SQ</a>(gamma3) + <a class="code" href="Math_8h.html#ac3644f84794a8bfdacf39c4b2c2495fc">SQ</a>(m1);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> b11 = 0;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> b22 = beta4 * (-beta1 * sinthe3 * cosphi3 - beta2 * sinthe3 * sinphi3 - beta3 * costhe3);</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> b12 = beta4 - alpha3 * beta4 * costhe3;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> b10 = gamma4 - alpha3 * gamma4 * costhe3;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> b01 = -0.5 - (beta1 * gamma4 + beta4 * gamma1) * sinthe3 * cosphi3 -</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                           (beta2 * gamma4 + beta4 * gamma2) * sinthe3 * sinphi3 -</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                           (beta3 * gamma4 + beta4 * gamma3) * costhe3;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> b00 = gamma4 * (-gamma1 * sinthe3 * cosphi3 - gamma2 * sinthe3 * sinphi3 - gamma3 * costhe3);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="comment">// Find the intersection of the 2 conics (at most 4 real solutions for (e1,ALPHA))</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        std::vector&lt;double&gt; e1, ALPHA;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <a class="code" href="Math_8h.html#a032d8963941cf3f2e11db530c5386f4e">solve2Quads</a>(a11, a22, a12, a10, a01, a00, b11, b22, b12, b10, b01, b00, e1, ALPHA, <span class="keyword">false</span>);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="comment">// For each solution (e1,ALPHA), find the neutrino 4-momentum p1</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="keywordflow">if</span> (e1.size() == 0)</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            <span class="keywordflow">return</span> Status::NEXT;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; e1.size(); i++) {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> E1 = e1.at(i);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> alp = ALPHA.at(i);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            <span class="comment">//Make sure E1 is not negative</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            <span class="keywordflow">if</span> (E1 &lt;= 0.)</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> E3 = beta4 * alp + gamma4;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <span class="comment">// Make sure E3 is not negative</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            <span class="keywordflow">if</span> (E3 &lt;= 0.)</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> p1x = beta1 * alp + gamma1;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> p1y = beta2 * alp + gamma2;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> p1z = alpha3 * E1 + beta3 * alp + gamma3;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            LorentzVector p1(p1x, p1y, p1z, E1);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> p3x = E3 * sinthe3 * cosphi3;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> p3y = E3 * sinthe3 * sinphi3;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> p3z = E3 * costhe3;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            LorentzVector p3_sol(p3x, p3y, p3z, E3);</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            <span class="comment">// Check if solutions are physical</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            LorentzVector tot = pT + p1 + p3_sol;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; m_branches.size(); i++) {</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                tot += *m_branches[i];</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            }</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> q1Pz = std::abs(tot.Pz() + tot.E()) / 2.;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> q2Pz = std::abs(tot.Pz() - tot.E()) / 2.;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            <span class="keywordflow">if</span> (q1Pz &gt; sqrt_s / 2 || q2Pz &gt; sqrt_s / 2)</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> jacobian = <a class="code" href="Math_8h.html#ac3644f84794a8bfdacf39c4b2c2495fc">SQ</a>(E3) * sinthe3 / (32 * <a class="code" href="Math_8h.html#ac3644f84794a8bfdacf39c4b2c2495fc">SQ</a>(M_PI) * <a class="code" href="Math_8h.html#ac3644f84794a8bfdacf39c4b2c2495fc">SQ</a>(sqrt_s) *</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                                              std::abs((p3_sol.Dot(p1 + *p2) + <a class="code" href="Math_8h.html#ac3644f84794a8bfdacf39c4b2c2495fc">SQ</a>(p3x) + <a class="code" href="Math_8h.html#ac3644f84794a8bfdacf39c4b2c2495fc">SQ</a>(p3y)) * (E2 * p1z - E1 * p2z) + p3x * p3z * (E1 * p2x - E2 * p1x)</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                                                  + p3x * E3 * (p1x * p2z - p1z * p2x) + p3y * p3z * (E1 * p2y - E2 * p1y) + E3 * p3y * (p1y * p2z - p1z * p2y)));</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            <a class="code" href="structSolution.html">Solution</a> s {{p1, p3_sol}, jacobian, <span class="keyword">true</span>};</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            solutions-&gt;push_back(s);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        }</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="keywordflow">return</span> solutions-&gt;size() &gt; 0 ? Status::OK : Status::NEXT;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    }</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordtype">double</span> sqrt_s;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordtype">bool</span> pT_is_met;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordtype">double</span> m1;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="comment">// Inputs</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <a class="code" href="classValue.html">Value&lt;double&gt;</a> s12;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <a class="code" href="classValue.html">Value&lt;double&gt;</a> s123;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    std::vector&lt;Value&lt;LorentzVector&gt;&gt; m_branches;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <a class="code" href="classValue.html">Value&lt;LorentzVector&gt;</a> m_met;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <a class="code" href="classValue.html">Value&lt;LorentzVector&gt;</a> p2;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <a class="code" href="classValue.html">Value&lt;LorentzVector&gt;</a> p3;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="comment">// Outputs</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    std::shared_ptr&lt;SolutionCollection&gt; solutions = produce&lt;SolutionCollection&gt;(<span class="stringliteral">&quot;solutions&quot;</span>);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;};</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;REGISTER_MODULE(<a class="code" href="classBlockC.html">BlockC</a>);</div><div class="ttc" id="structSolution_html"><div class="ttname"><a href="structSolution.html">Solution</a></div><div class="ttdoc">Generic solution structure representing a set of particles, along with its jacobian. </div><div class="ttdef"><b>Definition:</b> <a href="Solution_8h_source.html#l00028">Solution.h:28</a></div></div>
<div class="ttc" id="Math_8h_html"><div class="ttname"><a href="Math_8h.html">Math.h</a></div><div class="ttdoc">Mathematical functions. </div></div>
<div class="ttc" id="classBlockC_html_ac8275429daf5ec0611efd90474c20f16"><div class="ttname"><a href="classBlockC.html#ac8275429daf5ec0611efd90474c20f16">BlockC::work</a></div><div class="ttdeci">virtual Status work() override</div><div class="ttdoc">Main function. </div><div class="ttdef"><b>Definition:</b> <a href="BlockC_8cc_source.html#l00112">BlockC.cc:112</a></div></div>
<div class="ttc" id="structInputTag_html"><div class="ttname"><a href="structInputTag.html">InputTag</a></div><div class="ttdoc">An identifier of a module&amp;#39;s output. </div><div class="ttdef"><b>Definition:</b> <a href="InputTag__fwd_8h_source.html#l00037">InputTag_fwd.h:37</a></div></div>
<div class="ttc" id="classModule_html"><div class="ttname"><a href="classModule.html">Module</a></div><div class="ttdoc">Parent class for all the modules. </div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00037">Module.h:37</a></div></div>
<div class="ttc" id="classParameterSet_html"><div class="ttname"><a href="classParameterSet.html">ParameterSet</a></div><div class="ttdoc">A class encapsulating a lua table. </div><div class="ttdef"><b>Definition:</b> <a href="ParameterSet_8h_source.html#l00074">ParameterSet.h:74</a></div></div>
<div class="ttc" id="classBlockC_html"><div class="ttname"><a href="classBlockC.html">BlockC</a></div><div class="ttdoc"> Final (main) Block C, describing  </div><div class="ttdef"><b>Definition:</b> <a href="BlockC_8cc_source.html#l00081">BlockC.cc:81</a></div></div>
<div class="ttc" id="Math_8h_html_ac3644f84794a8bfdacf39c4b2c2495fc"><div class="ttname"><a href="Math_8h.html#ac3644f84794a8bfdacf39c4b2c2495fc">SQ</a></div><div class="ttdeci">#define SQ(x)</div><div class="ttdoc">Compute . </div><div class="ttdef"><b>Definition:</b> <a href="Math_8h_source.html#l00025">Math.h:25</a></div></div>
<div class="ttc" id="classValue_html"><div class="ttname"><a href="classValue.html">Value&lt; double &gt;</a></div></div>
<div class="ttc" id="classModule_html_a17cb586f94658e2048759c4cbdb7968d"><div class="ttname"><a href="classModule.html#a17cb586f94658e2048759c4cbdb7968d">Module::Module</a></div><div class="ttdeci">Module(PoolPtr pool, const std::string &amp;name)</div><div class="ttdoc">Constructor. </div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00061">Module.h:61</a></div></div>
<div class="ttc" id="Math_8h_html_a032d8963941cf3f2e11db530c5386f4e"><div class="ttname"><a href="Math_8h.html#a032d8963941cf3f2e11db530c5386f4e">solve2Quads</a></div><div class="ttdeci">bool solve2Quads(const double a20, const double a02, const double a11, const double a10, const double a01, const double a00, const double b20, const double b02, const double b11, const double b10, const double b01, const double b00, std::vector&lt; double &gt; &amp;E1, std::vector&lt; double &gt; &amp;E2, bool verbose=false)</div><div class="ttdoc">Solve a system of two quadratic equations. </div><div class="ttdef"><b>Definition:</b> <a href="Math_8cc_source.html#l00191">Math.cc:191</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
<script type="text/javascript" src="doxy-boot.js"></script>
</body>
</html>
